---
import BaseLayout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import StarsBackground from '../components/StarsBackground.astro';

const response = await fetch('https://api.github.com/orgs/Uwitz/repos?per_page=24&sort=updated');
let repos: any[] = [];
if (response.ok) {
  const json = await response.json();
  repos = (Array.isArray(json) ? json : [])
    .filter(r => !r.fork && !r.archived)
    .sort((a, b) => b.stargazers_count - a.stargazers_count);
}
---

<BaseLayout title="Uwitz">
  <StarsBackground />
  <Navbar />
  <main class="relative min-h-screen text-gray-100 pt-16">
    <div id="gradient-overlay" class="fixed inset-0 bg-gradient-to-b from-black to-red-900/30 opacity-100 transition-opacity duration-300 pointer-events-none"></div>
    <div class="relative">
      <!-- Hero Section -->
      <section class="container mx-auto px-4 min-h-[calc(100vh-4rem)] flex items-center">
        <div class="max-w-4xl mx-auto w-full">
          <div class="flex flex-col md:flex-row items-stretch gap-8">
            <div class="bg-black/40 backdrop-blur-sm rounded-2xl p-8 border border-red-500/20 shadow-xl flex flex-col">
                <div class="mb-6 mx-auto flex items-center justify-center">
                  <img 
                    src="/asterisk.svg" 
                    alt="Uwitz" 
                    class="w-64 h-64 object-contain"
                  />
                </div>
              <div class="flex-1 flex items-center justify-center">
                <h1 class="text-6xl font-jetbrains font-bold text-red-500 tracking-tight">Uwitz</h1>
              </div>
            </div>
            <div class="flex-1 space-y-8">
              <div class="bg-black/40 backdrop-blur-sm rounded-2xl p-8 border border-red-500/20 shadow-xl">
                <div class="flex justify-between items-center mb-3">
                  <h2 class="text-2xl font-bold text-red-500">Your Developer Community</h2>
                  <div class="flex gap-4">
                    <a href="https://discord.gg/YwC6VpEPfq" target="_blank" class="text-red-500 hover:text-red-400 transition-colors">
                      <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994.021-.041.001-.09-.041-.106a13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/>
                      </svg>
                    </a>
                    <a href="https://github.com/Uwitz" target="_blank" class="text-red-500 hover:text-red-400 transition-colors">
                      <svg class="w-5 h-5 translate-y-[2px]" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.237 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                      </svg>
                    </a>
                    <a href="mailto:contact@uwitz.org" class="text-red-500 hover:text-red-400 transition-colors">
                      <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 20 20" class="w-5 h-5 translate-y-[2px]" fill="currentColor">
                        <path d="M14.608 12.172c0 .84.239 1.175.864 1.175 1.393 0 2.28-1.775 2.28-4.727 0-4.512-3.288-6.672-7.393-6.672-4.223 0-8.064 2.832-8.064 8.184 0 5.112 3.36 7.896 8.52 7.896 1.752 0 2.928-.192 4.727-.792l.386 1.607c-1.776.577-3.674.744-5.137.744-6.768 0-10.393-3.72-10.393-9.456 0-5.784 4.201-9.72 9.985-9.72 6.024 0 9.215 3.6 9.215 8.016 0 3.744-1.175 6.6-4.871 6.6-1.681 0-2.784-.672-2.928-2.161-.432 1.656-1.584 2.161-3.145 2.161-2.088 0-3.84-1.609-3.84-4.848 0-3.264 1.537-5.28 4.297-5.28 1.464 0 2.376.576 2.782 1.488l.697-1.272h2.016v7.057h.002zm-2.951-3.168c0-1.319-.985-1.872-1.801-1.872-.888 0-1.871.719-1.871 2.832 0 1.68.744 2.616 1.871 2.616.792 0 1.801-.504 1.801-1.896v-1.68z"/>
                      </svg>
                    </a>
                  </div>
                </div>
                <p class="text-gray-300 leading-relaxed">
                  We are an organisation of Developers that focus on helping other Developers as well as provide open-source code that prioritises privacy & security.
                </p>
              </div>
              <div class="bg-black/40 backdrop-blur-sm rounded-2xl p-8 border border-red-500/20 shadow-xl">
                <div class="grid grid-cols-2 gap-4 mb-6">
                  <div class="bg-black/20 rounded-lg p-4 border border-red-500/20 relative">
                    <div class="flex items-center gap-2">
                      <div class="text-2xl font-bold text-red-500">Mission</div>
                    </div>
                    <div class="text-sm text-gray-300">Build secure, privacy-first tools for everyone.</div>
                  </div>
                  <div class="bg-black/20 rounded-lg p-4 border border-red-500/20">
                    <div class="text-2xl font-bold text-red-500 mb-1">Focus</div>
                    <div class="text-sm text-gray-300">open-source, self-hosted code, security compliance.</div>
                  </div>
                </div>
                <div class="flex gap-4">
                  <a href="/projects" class="flex-1 bg-black/40 hover:bg-black/60 text-red-500 px-6 py-2.5 rounded-lg transition-all duration-300 border border-red-500/20 hover:border-red-500/40 text-center font-medium">View Projects</a>
                  <a href="/donate" class="flex-1 bg-black/40 hover:bg-black/60 text-red-500 px-6 py-2.5 rounded-lg transition-all duration-300 border border-red-500/20 hover:border-red-500/40 text-center font-medium">
                    Donate
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- About Section -->
      <section id="about" class="container mx-auto px-4 py-4">
        <div class="max-w-4xl mx-auto">
          <div class="bg-black/40 backdrop-blur-sm rounded-2xl p-6 border border-red-500/20 shadow-xl">
            <h2 class="text-3xl font-bold mb-4 text-red-500 font-jetbrains tracking-tight">About Uwitz</h2>
            <div class="space-y-3">
              <p class="text-gray-300">
                Uwitz is an open-source organization dedicated to building practical privacy and security solutions for developers and organizations. We specialize in creating self-hosted services, API tooling, and security compliance that put user privacy first. Our mission is to make advanced security tools accessible to everyone through open-source development.
              </p>
              <p class="text-gray-300">
                Beyond our open-source contributions, we provide professional consulting and custom development services to companies seeking specialized security solutions or custom code development. Whether you need security audits, custom tooling, or specialized development work, our team brings deep expertise in privacy-focused technologies and secure coding practices.
              </p>
              <div class="flex flex-wrap gap-2 mt-4">
                <span class="px-3 py-1 bg-gray-800/50 rounded-full text-sm border border-red-500/10">Open-source</span>
                <span class="px-3 py-1 bg-gray-800/50 rounded-full text-sm border border-red-500/10">Privacy</span>
                <span class="px-3 py-1 bg-gray-800/50 rounded-full text-sm border border-red-500/10">Security</span>
                <span class="px-3 py-1 bg-gray-800/50 rounded-full text-sm border border-red-500/10">Linux</span>
              </div>
            </div>
          </div>
        </div>
    </section>

      <!-- Projects Section -->
      <section class="container mx-auto px-4 py-4">
        <div class="max-w-4xl mx-auto">
          <div class="bg-black/40 backdrop-blur-sm rounded-2xl p-6 border border-red-500/20 shadow-xl">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-3xl font-bold text-red-500 font-jetbrains tracking-tight">Projects</h2>
              <a href="https://github.com/Uwitz" target="_blank" class="text-sm text-gray-300 hover:text-red-400">View on GitHub →</a>
            </div>
            <p class="text-gray-300 mb-6">Open-source repositories maintained by Uwitz. Data fetched live from GitHub.</p>
            <div class="grid md:grid-cols-2 gap-4">
              {repos.length === 0 ? (
                <div class="text-gray-400">No repositories found or GitHub rate limit exceeded. Try again later.</div>
              ) : (
                repos.map(repo => (
                  <a href={repo.html_url} target="_blank" class="bg-black/40 backdrop-blur-sm rounded-2xl p-5 border border-red-500/20 shadow-2xl hover:border-red-500/40 transition-all group block">
                    <h3 class="text-xl font-bold mb-1 text-red-500 group-hover:text-red-400 transition-colors">{repo.name}</h3>
                    <p class="text-gray-300 mb-3">{repo.description || 'No description provided.'}</p>
                    <div class="flex items-center gap-3 text-sm text-gray-400">
                      <span>★ {repo.stargazers_count}</span>
                      <span>⑂ {repo.forks_count}</span>
                      {repo.language && <span>{repo.language}</span>}
                      <span>Updated {new Date(repo.updated_at).toLocaleDateString()}</span>
                    </div>
                  </a>
                ))
              )}
            </div>
          </div>
        </div>
      </section>

      <!-- Contact Section -->
      <section id="contact" class="container mx-auto px-4 py-4">
        <div class="max-w-4xl mx-auto">
          <div class="bg-black/40 backdrop-blur-sm rounded-2xl p-6 border border-red-500/20 shadow-2xl">
            <div class="mb-0 flex justify-between items-center">
              <h2 class="text-3xl font-bold text-red-500 font-jetbrains tracking-tight">Contact</h2>
              <button type="submit" 
                id="submit-button"
                class="bg-black/40 hover:bg-black/60 text-red-500 font-bold py-2 px-6 rounded-lg transition-all duration-300 flex items-center gap-2 border border-red-500/20 hover:border-red-500/40">
                <span id="button-text">Send Message</span>
                <svg id="button-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                </svg>
                <svg id="loading-icon" class="hidden w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
              </button>
            </div>
            <form id="contact-form" class="space-y-2">
              <div class="grid md:grid-cols-2 gap-3">
                <div class="space-y-1">
                  <label for="name" class="block text-sm font-medium text-red-500">Your Name</label>
                  <input 
                    type="text" 
                    id="name"
                    placeholder="John Doe" 
                    required 
                    class="w-full bg-gray-800/50 border border-red-500/20 rounded-lg px-3 py-2 text-gray-100 focus:outline-none focus:border-red-500 transition-colors placeholder-gray-500"
                  />
                </div>
                <div class="space-y-1">
                  <label for="email" class="block text-sm font-medium text-red-500">Your Email</label>
                  <input 
                    type="email" 
                    id="email"
                    placeholder="john@example.com" 
                    required 
                    class="w-full bg-gray-800/50 border border-red-500/20 rounded-lg px-3 py-2 text-gray-100 focus:outline-none focus:border-red-500 transition-colors placeholder-gray-500"
                  />
                </div>
              </div>
              <div class="space-y-1">
                <label for="subject" class="block text-sm font-medium text-red-500">Subject</label>
                <input 
                  type="text" 
                  id="subject"
                  placeholder="What's this about?" 
                  required 
                  class="w-full bg-gray-800/50 border border-red-500/20 rounded-lg px-3 py-2 text-gray-100 focus:outline-none focus:border-red-500 transition-colors placeholder-gray-500"
                />
              </div>
              <div class="space-y-1">
                <label for="message" class="block text-sm font-medium text-red-500">Your Message</label>
                <textarea 
                  id="message"
                  placeholder="Tell me more about your project..." 
                  required 
                  class="w-full bg-gray-800/50 border border-red-500/20 rounded-lg px-3 py-2 text-gray-100 focus:outline-none focus:border-red-500 transition-colors placeholder-gray-500 h-32 resize-none"
                ></textarea>
              </div>
      </form>
          </div>
        </div>
    </section>
    </div>
  </main>
</BaseLayout>

<style is:global>
  html {
    scroll-behavior: smooth;
  }
</style>

<script>
  const gradientOverlay = document.getElementById('gradient-overlay');
  
  function updateOverlayOpacity() {
    const maxScroll = (document.documentElement.scrollHeight - window.innerHeight);
    const scrollPercent = maxScroll > 0 ? (window.scrollY / maxScroll) * 100 : 0;
    const opacity = Math.max(0.3, 1 - (scrollPercent / 100));
    if (gradientOverlay) gradientOverlay.style.opacity = opacity.toString();
  }

  if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
    updateOverlayOpacity();
    window.addEventListener('load', updateOverlayOpacity);
    window.addEventListener('resize', updateOverlayOpacity);
    window.addEventListener('scroll', updateOverlayOpacity);
  }

  // Form submission handling
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const submitButton = document.getElementById('submit-button') as HTMLButtonElement;
  const buttonText = document.getElementById('button-text') as HTMLSpanElement;
  const buttonIcon = document.getElementById('button-icon') as HTMLElement;
  const loadingIcon = document.getElementById('loading-icon') as HTMLElement;

  if (form && submitButton && buttonText && buttonIcon && loadingIcon) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Get form values
      const name = (document.getElementById('name') as HTMLInputElement).value;
      const email = (document.getElementById('email') as HTMLInputElement).value;
      const subject = (document.getElementById('subject') as HTMLInputElement).value;
      const message = (document.getElementById('message') as HTMLTextAreaElement).value;

      // Show loading state
      buttonText.textContent = 'Preparing...';
      buttonIcon.classList.add('hidden');
      loadingIcon.classList.remove('hidden');
      submitButton.disabled = true;

      // Construct email content
      const emailBody = `Name: ${name}%0D%0AEmail: ${email}%0D%0A%0D%0A${message}`;
      const mailtoLink = `mailto:hello@snyco.dev?subject=${encodeURIComponent(subject)}&body=${emailBody}`;

      // Open email client
      window.location.href = mailtoLink;

      // Reset form and button state after a short delay
      setTimeout(() => {
        form.reset();
        buttonText.textContent = 'Send Message';
        buttonIcon.classList.remove('hidden');
        loadingIcon.classList.add('hidden');
        submitButton.disabled = false;
      }, 1000);
    });
  }
</script>

<style is:global>
  #gradient-overlay { will-change: opacity; transform: translateZ(0); }
  @media (prefers-reduced-motion: reduce) {
    #gradient-overlay { transition: none; }
  }
</style>
